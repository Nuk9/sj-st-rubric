<html>
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
<script type="text/javascript" src="/js/highlighter.js"></script>
<script type="text/javascript">

// Global Variable
var ANNOTATION_DATA = [];

$(document).ready(function(){

    var article_url="http://seattletimes.com/html/localnews/2019484765_specialed21m.html";
    var readability_url = "https://www.readability.com/api/content/v1/parser?token=43e6e0e0b590f00a095a6a0e64f6c9da11783a5a&callback=?&url=";
    var url = readability_url + article_url;
    $.getJSON(url,function(json){
       $('#document-viewer-container').append("<strong>" + json.author + "</strong>" + json.content);
       $('#document-viewer-container').highlighter({complete:function(){
          $('.highlighter-container input[type=radio]').prop('checked', false);
          $('.highlighter-container').css('visibility', 'visible');

       }});
    });
       
});
</script>


</head>
<body>

<div id="document-viewer-container"></div>

<span class='highlighter-container' style='visibility:hidden;'>
    <div id="pop-up-container" style="background-color: #ffcc00;">
      <form id="pop-up-form">
        <input type="radio" name="tag" value="problem"> Problem <br/>
        <input type="radio" name="tag" value="solution"> Solution <br/>
        <input type="radio" name="tag" value="response"> Response <br/>
        <input type="radio" name="tag" value="result"> Result <br/>
        <input type="radio" name="tag" value="response_to_solution"> Response to Solution <br/>
        <input type="radio" name="tag" value="response_to_result"> Response to Result <br/>
        <input id='submit-form' type="button" name="submit" value="submit">
      </form>
    </div>
</span>
<script type='text/javascript'>
  $( "#submit-form" ).click(function() {
    
    // get tag name
    var tag = $('input[name=tag]:checked', '#pop-up-form').val();
    console.log(tag);
    // determine color
    var color = '#000';
    if (tag == 'problem') {
      color = "blue";
    } else if (tag == 'solution') {
      color =  "red";
    } else if (tag == 'response') {
      color =  "green";
    } else if (tag == 'result') {
      color =  "yellow";
    } else if (tag =='response_to_solution') {
      color =  "pink";
    } else if (tag == 'response_to_result') {
      color =  "orange";
    }

    var selection = window.getSelection();
    if (selection.toString()!=="") {
      var range = selection.getRangeAt(0);

      var span = document.createElement("span");
      var fragment = range.cloneContents();
 
      // make new element, insert document fragment, then get innerHTML!
      var div = document.createElement('div');
      div.appendChild( fragment.cloneNode(true) );
 
      // your document fragment to a string (w/ html)! (yay!)
      var html = div.innerHTML;

      span.innerHTML = range.toString();
      span.style.backgroundColor = color;
      range.deleteContents();
      range.insertNode(span);
      console.log(span);  
    }


    highlight_dictionary = {
      'tag' : tag,
      'text' : range.toString()
    };

    ANNOTATION_DATA.push(highlight_dictionary);
    console.log(ANNOTATION_DATA);
  });  
</script>
</body>
</html>